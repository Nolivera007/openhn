---
title: "openhn"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{openhn}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(dplyr)
library(ggplot2)
library(tidyr)
library(openhn)
```

# Algunos ejemplos de uso de los datos que contiene este paquete.

## Datos `produccion`

```{r}
data("produccion")
head(produccion)
```

### Calcular el PIB para cada trimestre

1. Sumamos las primeras 13 actividades de Agricultura a Servicios Sociales (id 1 a 13).

```{r}
SUM <- produccion %>% 
  group_by(año, trimestre) %>% 
  filter(id %in% 1:13) %>% 
  summarise(hnl = sum(hnl))

head(SUM)
```

2. Obtenemos los Servicios de Intermediación Financieros Medidos Indirectamente (id 14).

```{r}
SIFMI <- produccion %>% 
  group_by(año, trimestre) %>% 
  filter(id %in% 14)
```

3. Cálculamos el Valor Agregado Bruto a precios básicos que es igual:
`SUM - SIFMI = VAB_pb`.

```{r}
VAB_pb = SUM$hnl - SIFMI$hnl
```

4. Obtenemos los Impuestos netos de subvenciones sobre la producción y las importaciones INSPM (id 15).

```{r}
INSPM <- produccion %>% 
  group_by(año, trimestre) %>% 
  filter(id %in% 15)
```

5. Cáculamos el PIB trimestral que es igual a:
`PIB_trimestral = VAB_pb + INSPM`.

```{r}
PIB_pm = VAB_pb + INSPM$hnl
```

Y por último creamos un `data.frame` con todos los datos.

```{r}
pib <- tibble(
  año = SUM$año,
  trimestre = SUM$trimestre,
  SUM = SUM$hnl,
  SIFMI = SIFMI$hnl,
  VAB_pb = VAB_pb,
  INSPM = INSPM$hnl,
  PIB_pm = PIB_pm
)

head(pib)
```
